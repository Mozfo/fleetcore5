# Fleetcore Implementation Plan (V1 & V2)

This plan outlines the detailed steps required to implement Fleetcore based on the functional specification and the data‐model **version 2**. It follows the **logical processes** defined in the process flow diagram (see image) and respects the naming conventions (prefixed modules, plural table names)【491524022416630†L64-L67】. Each phase lists the major tasks, dependencies and considerations. The plan assumes a modern stack (Next.js 15 + Prisma + PostgreSQL + Clerk) with deployments to a cloud provider.

## Legend

- **Dependencies** – tasks that must be completed first.
- **Artifacts** – DB tables, APIs, UI components or documentation produced.
- **Compliance** – note when local regulations (UAE or France) impact the task.

## Phase 0 – Preparation & Environment Setup

| Step | Description                                                                                                                       | Dependencies | Artifacts                                                                   |
| ---- | --------------------------------------------------------------------------------------------------------------------------------- | ------------ | --------------------------------------------------------------------------- |
| 0.1  | Finalise functional specification and data‑model; review with stakeholders.                                                       | —            | Approved specification (current doc).                                       |
| 0.2  | Define project structure, repositories and branch strategy.                                                                       | 0.1          | Git repo, CI/CD skeleton.                                                   |
| 0.3  | Provision development environments (dev/stage/prod), choose cloud provider, and set up infrastructure as code (Terraform/Pulumi). | 0.1          | Cloud accounts, IaC scripts.                                                |
| 0.4  | Install and configure **Prisma** with PostgreSQL; apply base schema from `fleetcore_data_model_v2.md`.                            | 0.3          | Initial database with prefixed schemas (e.g. `flt_vehicles`).               |
| 0.5  | Integrate **Clerk** for authentication/SSO/MFA and configure organizations (tenants) and roles.                                   | 0.3          | Clerk tenant configured; mapping of `clerk_organization_id` to `tenant_id`. |
| 0.6  | Set up logging and monitoring (metrics, error tracking) and define naming conventions.                                            | 0.3          | Logging pipeline; coding standards document.                                |

## Phase 1 – Core Entities & Directory Management

| Step | Description                                                                                                                                                                                                                                                           | Dependencies | Artifacts                                                                          |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | ---------------------------------------------------------------------------------- |
| 1.1  | Implement **Tenant** and admin modules: create tenants, manage subscription plans, lifecycle events (`adm_tenant_lifecycle_events`), assign account managers (`adm_tenant_account_managers`).                                                                         | 0.4–0.6      | DB migrations for `adm_` tables; Tenant management UI/API.                         |
| 1.2  | Build **Role & Permission** system mapped to Clerk roles (RBAC). Create UI for assigning roles to members and define domain scopes (fleet, driver, finance, admin).                                                                                                   | 0.5          | `adm_roles` & `adm_role_permissions` tables; role management screens.              |
| 1.3  | Implement **Directory** tables (`dir_car_makes`, `dir_car_models`, `dir_platforms`, `dir_vehicle_classes`, etc.) with CRUD operations.                                                                                                                                | 0.4          | Directory management UI/API; ensures reference data can be updated by each tenant. |
| 1.4  | Create polymorphic **Document** module (`doc_documents` table) to store scanned files for vehicles, drivers, insurance, licences, residency cards and other compliance documents.                                                                                     | 0.4          | Document upload service (S3 or similar), `doc_document_versions`.                  |
| 1.5  | Set up **CountryRegulation** and related tables (`dir_insurance_types`, `fin_toll_gates`, `fin_traffic_fines`) to capture local regulatory constraints (vehicle age limits, VTC licence rules, toll fees)【611243862873268†L268-L280】. Seed data for France and UAE. | 0.4          | Seed scripts; regulatory service.                                                  |

## Phase 2 – Vehicle & Driver Lifecycle

| Step | Description                                                                                                                                                                                                                                                     | Dependencies | Artifacts                                                |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | -------------------------------------------------------- |
| 2.1  | Implement **Vehicle Acquisition** and **Vehicle Onboarding**. Create forms to record purchase/leasing details (`flt_vehicle_acquisitions`) and initial vehicle records (`flt_vehicles`). Validate against local age limits【611243862873268†L268-L280】.        | 1.3,1.4,1.5  | UI/API for vehicle onboarding, `flt_vehicles` migration. |
| 2.2  | Develop **Document & Insurance Management**. Link uploaded documents to vehicles via `doc_documents` and `flt_vehicle_insurances`. Implement expiry alerts and compliance checks.                                                                               | 2.1          | Document management service with notifications.          |
| 2.3  | Implement **Assignment & Scheduling**. Create `flt_vehicle_assignments` and `rid_driver_assignments` to allocate vehicles to drivers. Use `sch_shifts` and `sch_tasks` to plan maintenance and shift schedules, with conflict detection.                        | 2.1,2.4      | Scheduling UI; assignment API.                           |
| 2.4  | Build **Driver Recruitment & Onboarding**. Create `rid_drivers` and `rid_driver_residency_documents` (visa, Emirates ID, labour card). Validate French professional card (`professional_card_no`, expiry) and UAE residency rules【611243862873268†L268-L280】. | 1.4,1.5      | Driver onboarding wizard; `rid_drivers` migration.       |
| 2.5  | Implement **Training & Certification**. Create `rid_driver_training_records` (course name, completion date, expiry) and integrate with RTA/CPD programmes. Issue alerts for upcoming training renewals.                                                         | 2.4          | Training management UI.                                  |
| 2.6  | Implement **Trip Execution & Performance**. Record trip performance metrics (ratings, cancellations, punctuality) in `rid_driver_performance`. Provide dashboards for drivers and fleet managers.                                                               | 2.3          | Performance analytics UI.                                |
| 2.7  | Handle **Contract & Feedback**. Manage contract types (fixed, percent, salary, buyout, investor) via `rid_driver_contracts` or reuse existing cooperation term structures. Implement feedback loop from passengers/platforms.                                   | 2.4–2.6      | Contract records; contract change workflows.             |
| 2.8  | Implement **Offboarding & Blacklist**. Create `rid_driver_blacklist` capturing reasons and dates; ensure offboarded drivers cannot be assigned new trips.                                                                                                       | 2.7          | Offboarding process; UI restrictions.                    |
| 2.9  | Implement **Maintenance & Repairs** workflows. Use `flt_vehicle_maintenance` and `sch_maintenance_schedules` to record preventive maintenance, repairs, inspections and costs. Integrate with service providers.                                                | 2.1          | Maintenance scheduler; cost recording.                   |
| 2.10 | Build **Accident & Fine** module. Create `flt_vehicle_accidents` and `fin_traffic_fines`. Capture insurance claims, photographs and attach documents via `doc_documents`. Handle driver accountability and deduct fines from payroll.                           | 2.1,2.4      | Accident reporting UI; fine tracking.                    |
| 2.11 | Implement **Vehicle Disposal/Replacement**. Create `flt_vehicle_disposals` and record sales or end of lease. Ensure associated assignments and documents are closed. Link to investor payout calculations.                                                      | 2.1,2.9      | Disposal workflow.                                       |

## Phase 3 – Trip & Platform Integration

| Step | Description                                                                                                                                                                                                                                    | Dependencies | Artifacts                                       |
| ---- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | ----------------------------------------------- |
| 3.1  | Integrate **Platform Accounts** (`dir_platforms`, `flt_platform_accounts`) with Uber, Bolt, Careem and MyTaxiCRM. Implement OAuth flows or API key storage in `adm_integration_credentials`.                                                   | 1.3,1.4      | Platform connection UI; secure secrets storage. |
| 3.2  | Build **Trip Data Capture**. Pull trip details via API/webhooks into `trp_trips` and `trp_trip_lines`. Normalize statuses (ongoing, completed, cancelled), fares and commission splits.                                                        | 3.1          | Trip ingestion service; event consumers.        |
| 3.3  | Implement **Real‑time Status Dashboard**. Use `flt_vehicle_platform_statuses` and `rid_driver_statuses` (if created) to show online/offline state across platforms【705897994408243†L127-L144】. Provide filters by platform, vehicle, driver. | 3.1,3.2      | Real‑time dashboard UI; websockets or polling.  |
| 3.4  | Develop **Shift & Task Planner**. Use `sch_shifts` and `sch_tasks` to schedule driver shifts, maintenance tasks and vehicle branding or licensing appointments.                                                                                | 2.3          | Planner UI; conflict detection.                 |
| 3.5  | Create **Office Trip Booking** module for corporate rides. Use `trp_office_trip_bookings` and `trp_invoice_lines` to schedule rides requested by corporate clients. Align with B2B invoicing.                                                  | 3.2          | Corporate booking portal; client API.           |

## Phase 4 – Financial Transactions & Payroll

| Step | Description                                                                                                                                                                                                                                                                                                 | Dependencies | Artifacts                                                    |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | ------------------------------------------------------------ |
| 4.1  | Establish **Financial Accounts**. Use `fin_accounts` to represent wallets (fleet, drivers, investors). Implement `fin_transactions` to record all credits and debits (trip earnings, expenses, payments).                                                                                                   | 3.2          | Accounting engine.                                           |
| 4.2  | Implement **Revenue Share & Investor Payouts**. Define revenue rules per trip using `fin_revenue_share_rules` (if needed) and allocate earnings between driver, fleet and investors via `fin_transactions`. Use `inv_vehicle_investors` to compute investor proportions.                                    | 4.1          | Revenue calculation service.                                 |
| 4.3  | Build **Driver Payroll (WPS)**. Create WPS batches via `fin_driver_payment_batches`; generate SIF files conforming to UAE WPS requirements; store them in S3; mark payments in `fin_driver_payments`. Support export for non‑UAE payroll via SEPA or local bank file formats (France).                      | 4.1          | WPS generator & export; payroll approval workflow.           |
| 4.4  | Handle **Expenses & Fines**. Record vehicle expenses (`flt_vehicle_expenses`), toll transactions (`fin_toll_transactions`) and traffic fines. Implement deduction rules (e.g., driver pays 100 % of speeding fine; fleet pays toll). Link deductions to payroll.                                            | 2.10         | Expense management API.                                      |
| 4.5  | Develop **Billing & Tenant Invoicing**. Compute monthly subscription fees and usage charges using `bil_tenant_usage_metrics`. Generate invoices via `bil_tenant_invoices` and `bil_tenant_invoice_lines` including VAT rates (country specific). Send invoices and track statuses in `bil_tenant_payments`. | 1.1,1.5      | Billing engine; invoice PDF generator; payment integrations. |
| 4.6  | Integrate **Accounting Export**. Provide exports to accounting software (Xero, QuickBooks, Zoho). Support mapping of `fin_transactions` to accounts.                                                                                                                                                        | 4.1–4.5      | Accounting export modules.                                   |

## Phase 5 – CRM & SaaS Operations

| Step | Description                                                                                                                                                                                                                                                            | Dependencies | Artifacts                                        |
| ---- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | ------------------------------------------------ |
| 5.1  | Implement **Lead Management**. Create `crm_leads` to store prospects; allow multi‑channel capture (web forms, ads). Provide dashboards to qualify leads.                                                                                                               | 0.4          | Lead capture forms; CRM API.                     |
| 5.2  | Develop **Sales Opportunity & Contract** modules. Use `crm_opportunities` and `crm_contracts` to track sales pipeline and signed contracts. Link to `adm_tenant_lifecycle_events`.                                                                                     | 5.1          | Sales pipeline UI; contract management.          |
| 5.3  | Build **Tenant Onboarding & Setup**. Automate provisioning of a new tenant: create default directories, roles, sample data and assign account manager. Trigger from sales contract signature.                                                                          | 5.2          | Onboarding service; tenant provisioning scripts. |
| 5.4  | Monitor **Usage & Analytics**. Aggregate metrics in `bil_tenant_usage_metrics` (active drivers, vehicles, trips, support tickets). Use them to forecast churn and upsell opportunities.                                                                                | 4.5          | Analytics dashboards; alerts.                    |
| 5.5  | Implement **Support & Customer Success**. Create `sup_tickets`, `sup_ticket_messages` and `sup_customer_feedback`. Embed a widget in the admin portal for tenants to open tickets. Provide SLA tracking and escalation. Link support insights to product improvements. | 3.3,5.3      | Support portal; agent interface.                 |
| 5.6  | Build **Plan Renewal & Upsell** flows. Notify tenants before subscription expiry; allow upgrading/downgrading plans; adjust usage limits and pricing accordingly.                                                                                                      | 5.3,4.5      | Renewal workflow; upsell logic.                  |

## Phase 6 – Administration & Provider Operations

| Step | Description                                                                                                                                                                                                   | Dependencies | Artifacts                                  |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | ------------------------------------------ |
| 6.1  | Implement **Provider Employee & Account Manager** modules. Use `adm_provider_employees` and `adm_tenant_account_managers` to manage staff. Restrict capabilities by role (sales, support, finance).           | 1.1          | Admin portal for provider.                 |
| 6.2  | Build **Tenant Monitoring & Activity Tracking**. Use `adm_tenant_activity_metrics` and `adm_tenant_activity_events` to record usage patterns, feature adoption and health scores. Create dashboards for CSMs. | 5.4          | Tenant health dashboards.                  |
| 6.3  | Implement **Integration & Audit Logging**. Maintain `adm_integration_logs` for third‑party API calls and `adm_audit_logs` for user actions. Provide export and retention policies.                            | 1.5          | Logging service; compliance documentation. |
| 6.4  | Set up **Alerts & Notifications**. Configure Slack/email/SMS notifications for critical events: document expiry, payment failures, platform connection errors, low usage.                                     | All phases   | Notification rules; messaging service.     |

## Phase 7 – Reporting & Analytics

| Step | Description                                                                                                                                                                                                                   | Dependencies | Artifacts                             |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | ------------------------------------- |
| 7.1  | Define **Key Performance Indicators (KPIs)** for fleet operations (profit per km, utilisation rate, downtime, customer ratings), driver performance, financial metrics (net revenue, ARPU), and SaaS metrics (MRR, churn).    | 4.5,5.4      | KPI definitions; metrics catalogue.   |
| 7.2  | Create **Dashboards** for each persona: fleet manager, driver, finance controller, investor, tenant administrator and provider. Use aggregated data from earlier phases and `analytics` tables or data warehouse.             | 7.1          | Dashboard UIs.                        |
| 7.3  | Implement **Reporting Engine**. Generate periodic reports (daily, weekly, monthly) and schedule email exports. Provide ad‑hoc reporting capabilities with filters by date, platform, driver or vehicle.                       | 7.2          | Report templates; export service.     |
| 7.4  | Ensure **Compliance & Audit**. Use the cross‑cutting `adm_audit_logs` to track data access; maintain data retention policies; handle GDPR and UAE data protection laws. Monitor PII compliance (driver documents, residency). | All          | Compliance reports; audit procedures. |

## Phase 8 – Investor Management

| Step | Description                                                                                                                                                                 | Dependencies | Artifacts                                           |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------ | --------------------------------------------------- |
| 8.1  | Implement **Investor Directory**. Create `inv_investors` to store investor profiles. Provide onboarding forms and KYC verification.                                         | 4.2          | Investor portal; KYC service.                       |
| 8.2  | Develop **Vehicle Investor Allocation**. Manage `inv_vehicle_investors` linking investors to vehicles with percentage shares. Recalculate revenue distribution accordingly. | 4.2          | Investor allocation UI; revenue calculation update. |
| 8.3  | Generate **Investor Statements**. Provide monthly statements showing share of revenue, expenses and payouts; allow investors to download reports.                           | 8.2          | Investor reporting module.                          |

## Phase 9 – Extended Capabilities (Lot 2)

These modules are not essential for V1 but will enhance Fleetcore’s value in later releases.

| Step | Description                                                                                                                                                                                                  | Dependencies | Artifacts                                                                    |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------ | ---------------------------------------------------------------------------- |
| 9.1  | Implement **Stock & Inventory Management**. Introduce tables for devices/accessories (smartphones, tablets, baby seats), assign them to drivers or vehicles and track issuance, return and depreciation.     | 2.3          | Inventory module; integrated with payroll deductions for lost/damaged items. |
| 9.2  | Develop **Geo‑location & Telemetry**. Collect real‑time GPS and telematics data from vehicles; store in `flt_vehicle_telemetry`; display heatmaps and speed alerts.                                          | 3.2          | Telemetry ingestion service; geospatial dashboards.                          |
| 9.3  | Extend **HR & Workforce Management**. Manage leave requests, schedules, training plans and performance reviews in a unified HR module (`hr_leaves`, `hr_appraisals`). Integrate with payroll and compliance. | 2.4,2.5      | HR management portal.                                                        |
| 9.4  | Add **Marketing Campaigns**. Create `crm_campaigns` and `crm_campaign_recipients` to send targeted SMS/email campaigns to drivers or corporate clients; track open rates and conversions.                    | 5.1          | Marketing automation tools.                                                  |

## Phase 10 – Testing, Deployment & Go‑Live

| Step | Description                                                                                                                                                                                             | Dependencies         | Artifacts                               |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------- | --------------------------------------- |
| 10.1 | Write unit tests for all services; implement integration tests for critical flows (vehicle onboarding, trip ingestion, payroll, invoicing, support).                                                    | All preceding phases | Test suites; CI pipelines.              |
| 10.2 | Perform **User Acceptance Testing (UAT)** with representative tenants and drivers; refine UX and performance issues.                                                                                    | 10.1                 | UAT feedback; issue backlog.            |
| 10.3 | Set up **Deployment Pipelines**. Configure CI/CD to build, test and deploy the Next.js app and Prisma migrations automatically. Use canary deployments and feature flags.                               | 10.1                 | CI/CD pipelines.                        |
| 10.4 | Prepare **Migration Scripts**. For existing data (if migrating from legacy systems), write ETL scripts to populate new schemas (`doc_documents`, `fin_driver_payments`, etc.). Validate data integrity. | 4.3,4.5              | Migration and import scripts.           |
| 10.5 | Conduct **Performance & Security Audits**. Load test critical endpoints; conduct penetration testing; review compliance with data protection regulations.                                               | 10.1–10.3            | Audit reports; remediation tasks.       |
| 10.6 | Launch **Production Environment**. Deploy the system; ensure monitoring and alerting are in place; perform smoke tests. Train customer support and sales teams on the new platform.                     | All                  | Production release; training materials. |

## Notes on Compliance & Dependencies

- **Local regulations**: always consult legal experts to update `dir_country_regulations` and `dir_platforms` with new rules (e.g., modifications in French VTC minimum fare【611243862873268†L268-L280】 or UAE RTA visa requirements).
- **Naming conventions**: adhere strictly to the naming rules defined in the `fleetcore_naming_guidelines.md` document【491524022416630†L64-L67】—tables plural, snake_case, prefixes by domain—and ensure Prisma models reflect these.
- **Modularity**: each domain should be encapsulated in its own module or service to minimise coupling; cross‑module references are managed through foreign keys (as shown in the data model).
- **Extensibility**: the plan leaves room for future modules (telemetry, HR) to be added without impacting the core services. Use event‑driven architecture (e.g., via a message broker) to decouple ingestion of trip data and payroll/invoicing calculations.

This implementation plan provides a comprehensive roadmap for building Fleetcore, aligning the **end‑to‑end processes** (vehicle, driver, finance, SaaS operations) with a realistic sequence of tasks and dependencies. It can be adapted into a Gantt chart or project management tool to allocate resources and track progress.
